        // --- 1. ATS 極限再現 (音響物理シミュレーション版) ---
        document.getElementById('atsBtn').onclick = () => {
            setupAudio();
            if (intervals.ats) return;
            const lamp = document.getElementById('atsLamp');
            const stat = document.getElementById('stat');
            let t = 0;

            intervals.ats = setInterval(() => {
                const now = audioCtx.currentTime;
                if (t < 35) { // 打撃音セクション
                    stat.textContent = "STATUS: ATS ALARM!!";
                    lamp.classList.toggle('red');

                    // 金属ベルの共鳴を再現する5つの倍音層
                    const bellResonators = [1102, 1108, 1215, 1222, 1350];
                    bellResonators.forEach((f, i) => {
                        const osc = audioCtx.createOscillator();
                        const g = audioCtx.createGain();
                        
                        // 物理的な打撃の「揺れ」を再現するため微弱なデチューンを加える
                        osc.type = i % 2 === 0 ? 'sawtooth' : 'triangle';
                        osc.frequency.setValueAtTime(f + (Math.random() * 10 - 5), now);
                        
                        g.gain.setValueAtTime(0.04, now);
                        // ベルの打撃特有の急速な減衰
                        g.gain.exponentialRampToValueAtTime(0.0001, now + 0.08);
                        
                        osc.connect(g);
                        g.connect(audioCtx.destination);
                        osc.start(now);
                        osc.stop(now + 0.08);
                    });
                } else { // 電子チャイムセクション
                    stat.textContent = "STATUS: ATS CHIME";
                    lamp.classList.add('red');
                    
                    // 「キン・コン」の切り替え周期
                    const isHigh = (t % 8 < 4);
                    const freq = isHigh ? 1318.5 : 1046.5; 
                    
                    // 実機のスピーカー特性（中音域の響き）を再現
                    const osc = audioCtx.createOscillator();
                    const g = audioCtx.createGain();
                    const filter = audioCtx.createBiquadFilter();

                    osc.type = 'sine';
                    osc.frequency.setValueAtTime(freq, now);

                    // フィルターで音に「芯」を作る
                    filter.type = 'bandpass';
                    filter.frequency.value = freq;
                    filter.Q.value = 1.5;

                    g.gain.setValueAtTime(0, now);
                    g.gain.linearRampToValueAtTime(0.06, now + 0.02); // わずかに立ち上げる
                    g.gain.exponentialRampToValueAtTime(0.001, now + 0.7); // 長い余韻

                    osc.connect(filter);
                    filter.connect(g);
                    g.connect(audioCtx.destination);

                    osc.start(now);
                    osc.stop(now + 0.8);
                    
                    // インターバルをチャイム用に調整
                    if (t === 35) {
                        clearInterval(intervals.ats);
                        intervals.ats = setInterval(arguments.callee, 450);
                    }
                }
                t++;
            }, 85); // 打撃音のスピードをよりリアルに高速化
        };
