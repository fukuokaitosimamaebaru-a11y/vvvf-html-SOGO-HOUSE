<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>ATS-S 極限再現コンソール</title>
    <style>
        body { background: #1a1c1a; color: #fff; font-family: 'MS Gothic', sans-serif; display: flex; align-items: center; justify-content: center; height: 100vh; margin: 0; }
        .panel { background: #c0c0c0; padding: 25px; border: 6px outset #eee; border-radius: 4px; width: 340px; color: #000; box-shadow: 0 20px 40px rgba(0,0,0,0.8); }
        .lamp-group { display: flex; justify-content: space-around; margin-bottom: 20px; }
        .lamp { width: 40px; height: 40px; border-radius: 50%; border: 3px solid #333; background: #331111; }
        .lamp.red { background: #ff0000; box-shadow: 0 0 15px #f00; border-color: #500; }
        .btn-group { display: flex; flex-direction: column; gap: 10px; }
        button { padding: 18px; font-size: 1.1rem; font-weight: bold; cursor: pointer; border: 4px solid #444; background: #ddd; }
        button:active { border-style: inset; }
        .btn-ats { background: #ff4400; color: #fff; }
        .btn-door { background: #22dd22; }
        .btn-horn { background: #0088ff; color: #fff; }
        .status { background: #000; color: #0f0; padding: 10px; font-family: 'Courier New', monospace; margin: 10px 0; border: 2px inset #555; font-size: 0.8rem; text-align: left; }
    </style>
</head>
<body>

    <div class="panel">
        <div class="lamp-group">
            <div id="atsLamp" class="lamp"></div>
            <div style="font-weight: bold; padding-top: 10px;">ATS-S SYSTEM</div>
        </div>
        <div class="status" id="stat">STATUS: NORMAL</div>
        <div class="btn-group">
            <button id="atsBtn" class="btn-ats">ATS作動 (動画再現)</button>
            <button id="doorBtn" class="btn-door">戸締め (テゥンテゥーン)</button>
            <button id="hornBtn" class="btn-horn">警笛 (空気笛再現)</button>
            <button id="stopBtn" style="background: #fff;">ATS確認 (復帰)</button>
        </div>
    </div>

    <script>
        let audioCtx;
        let intervals = { ats: null, door: null };
        let hornNodes = null;

        const setupAudio = () => {
            if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            if (audioCtx.state === 'suspended') audioCtx.resume();
        };

        // --- 究極再現：JR西日本風「ピピッ・ピピッ」ロジック ---
        function runAts() {
            const lamp = document.getElementById('atsLamp');
            const stat = document.getElementById('stat');
            stat.textContent = "STATUS: ATS ALARM!!";

            intervals.ats = setInterval(() => {
                const now =
