<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>RESONANCE LOCK - MAX</title>
    <style>
        body { 
            background: #000; color: #ff0000; font-family: 'Arial Black', sans-serif;
            text-align: center; height: 100vh; display: flex; flex-direction: column; justify-content: center;
        }
        .display { font-size: 5rem; text-shadow: 0 0 20px #f00; margin: 20px 0; }
        .controls { margin: 20px; }
        input[type=range] { width: 80%; height: 20px; cursor: pointer; }
        .adjust-btns button { 
            padding: 15px 30px; font-size: 1.5rem; margin: 5px;
            background: #222; color: #ff0000; border: 2px solid #ff0000; cursor: pointer;
        }
        #mainBtn { 
            padding: 40px 100px; font-size: 2.5rem; background: #ff0000; color: #000;
            border: none; border-radius: 50px; cursor: pointer; font-weight: bold;
            box-shadow: 0 0 40px #f00;
        }
    </style>
</head>
<body>

    <div class="display"><span id="freqVal">30.0</span>Hz</div>
    
    <div class="controls">
        <input type="range" id="freqSlider" min="10" max="100" step="0.1" value="30.0">
        <div class="adjust-btns">
            <button onclick="adjust(-1)">-1Hz</button>
            <button onclick="adjust(-0.1)">-0.1Hz</button>
            <button onclick="adjust(0.1)">+0.1Hz</button>
            <button onclick="adjust(1)">+1Hz</button>
        </div>
    </div>

    <button id="mainBtn">LOCK ON / START</button>

    <script>
        let audioCtx, osc, gainNode, isRunning = false;
        const freqVal = document.getElementById('freqVal');
        const freqSlider = document.getElementById('freqSlider');
        const mainBtn = document.getElementById('mainBtn');

        function updateFreq(val) {
            const f = parseFloat(val).toFixed(1);
            freqVal.textContent = f;
            freqSlider.value = f;
            if (osc) osc.frequency.setTargetAtTime(f, audioCtx.currentTime, 0.01);
        }

        function adjust(amt) {
            updateFreq(parseFloat(freqSlider.value) + amt);
        }

        freqSlider.oninput = (e) => updateFreq(e.target.value);

        mainBtn.onclick = () => {
            if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();

            if (!isRunning) {
                osc = audioCtx.createOscillator();
                gainNode = audioCtx.createGain();
                
                // 最も押し出しの強い「矩形波」に固定
                osc.type = 'square';
                osc.frequency.setValueAtTime(freqSlider.value, audioCtx.currentTime);
                
                // 外部スピーカーを振り切らせるための最大ゲイン
                gainNode.gain.setValueAtTime(1.0, audioCtx.currentTime);

                osc.connect(gainNode);
                gainNode.connect(audioCtx.destination);
                osc.start();
                
                mainBtn.textContent = "STOP";
                mainBtn.style.background = "#444";
                isRunning = true;
            } else {
                osc.stop();
                isRunning = false;
                mainBtn.textContent = "LOCK ON / START";
                mainBtn.style.background = "#ff0000";
            }
        };
    </script>
</body>
</html>
