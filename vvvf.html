<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>PULL & PUSH CANNON</title>
    <style>
        body { background: #000; color: #0f0; text-align: center; font-family: 'Arial Black', sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; margin: 0; }
        .cannon-frame { border: 10px double #0f0; padding: 40px; border-radius: 20px; box-shadow: 0 0 30px #0f0; }
        .fire-btn { 
            width: 200px; height: 200px; border-radius: 50%; border: none;
            background: #0f0; color: #000; font-size: 2.5rem; font-weight: bold;
            cursor: pointer; box-shadow: 0 0 20px #0f0;
        }
        .fire-btn:active { transform: scale(0.8); background: #fff; }
        #indicator { margin-top: 20px; font-size: 1.5rem; height: 1.5rem; }
    </style>
</head>
<body>

    <div class="cannon-frame">
        <div id="indicator">READY</div>
        <button class="fire-btn" id="fireBtn">PUSH</button>
    </div>

    <script>
        let audioCtx;
        const btn = document.getElementById('fireBtn');
        const indicator = document.getElementById('indicator');

        btn.onclick = () => {
            if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            
            // 物理衝撃プロセッサ
            const bufferSize = audioCtx.sampleRate * 0.2;
            const buffer = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate);
            const data = buffer.getChannelData(0);

            // 1. 「引き」のフェーズ (コーンを奥へ)
            const pullDuration = 2000; // サンプル数
            for (let i = 0; i < pullDuration; i++) {
                data[i] = -1.0; 
            }

            // 2. 「押し」のフェーズ (一気に射出)
            const pushStart = pullDuration;
            const pushDuration = 500; 
            for (let i = pushStart; i < pushStart + pushDuration; i++) {
                data[i] = 1.0; 
            }

            const source = audioCtx.createBufferSource();
            source.buffer = buffer;
            const gain = audioCtx.createGain();

            // 外部スピーカーを無理やり動かすための過剰ゲイン
            gain.gain.setValueAtTime(100.0, audioCtx.currentTime); 

            source.connect(gain);
            gain.connect(audioCtx.destination);

            source.start();

            // アニメーション演出
            indicator.textContent = "PULLING...";
            indicator.style.color = "#f00";
            setTimeout(() => {
                indicator.textContent = "PUSH!!!";
                indicator.style.color = "#fff";
                setTimeout(() => {
                    indicator.textContent = "READY";
                    indicator.style.color = "#0f0";
                }, 200);
            }, 50);
        };
    </script>
</body>
</html>
